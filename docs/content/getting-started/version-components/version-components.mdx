import { Image } from '@teambit/docs.ui.zoomable-image';
import {
  StatusExample,
  StatusOutput,
  BitSnap,
  SnapExample,
  SnapOutput,
  CreateLaneExample,
  BitTag,
  TagExample,
  TagOutput,
  BitReset,
  ResetExample,
  ResetOutput,
  CheckoutExample,
  AutoSnapStatusOutput,
  LogExample,
  DiffExample,
} from './commands';
import { ExpandedSnap, ExpandedTag, ExpandedReset, ExpandedLog } from './expand-command-options';
import changelog from './changelog.png';
import versionPicker from './version-picker.png';
import compare from './compare.png';

# Snapping components

For a component to be independently collaborated on, it must maintain its own version history.
This history consists of 'snaps', which are the component's immutable recorded changes. Each snap records the state of the entire component including its source files, [dependencies](/getting-started/composing/use-dependencies), [configuration](/components/component-config), [metadata](/components/structure/component-metadata), and [build artifacts](/components/structure/component-artifacts).

Snaps are stored in the [local scope](/workspace/structure/local-scope) before they are exported to their [remote scopes](/getting-started/collaborate/remote-scope).

## Create a snap

Before you record your component's state, verify no issues are preventing it from being isolated from the workspace:

<StatusExample />

The output should display no issues. Note that this component is listed as 'new' as it haven't been snapped yet.

<StatusOutput />

Run the following to snap the latest component changes:

<SnapExample />

<ExpandedSnap />

The output lists the snapped component and the hash that points to that snap:

<SnapOutput />

The snap process includes a series of build tasks. The data and artifacts generated by these build tasks are persisted in that snap.
To learn more, see [Build pipelines](/dev-services/builder/build-pipelines). To learn more about snaps, see [Snapping changes](/components/snaps).

:::info Use 'lanes' (alpha) to suggest cross-component changes
Use 'lanes' to collaborate on groups of components without interfering with the main development course. For example, to
create a new lane named 'new-feature', and switch to that lane, run:

<CreateLaneExample />

New snaps will now be part of the 'new-feature' lane, instead of the default 'main' lane. Merge the 'new-feature' lane into the 'main' lane, when the new updates are ready.

To learn more, see [Lanes overview](/docs/lanes/lanes-overview).
:::

## Create a tag (release version)

To record changes that represent a new release, create a snap that's tagged with a [sematic version](https://semver.org/):

<TagExample />

<ExpandedTag />

The output lists the snapped component and the semantic version that points to that snap.
Since no information regarding the semantic version number was provided, the tag defaulted to the next patch number:

<TagOutput />

The tag process includes a series of build tasks. The data and artifacts generated by these build tasks are persisted in that snap.
To learn more, see [Build pipelines](/dev-services/builder/build-pipelines). To learn more about tags, see [Tagging changes](/components/tags).

## Reset snaps

To reset snaps (that have not been exported yet), and revert a component to its previous state, run the following:

<ResetExample />

<ExpandedReset />

The output notifies `apps/to-do` has been reset. Its tag version, `1.0.0`, has been removed. The component is now back to its previous status as 'new':

<ResetOutput />

Note that the 'reset' command does not affect the component's source files in the workspace. To checkout the source files of a component after resetting, run:

<CheckoutExample />

## Auto-snap dependent components

Bit uses the workspace dependency graph to snap (and build) the direct and indirect dependents of a snapped component.
This ensures all affected components are tested, built and versioned accordingly.
This also ensures unaffected components are not built nor versioned, to provide efficient builds and avoid insignificant component updates for consumers of components.

Check your component status to discover components that are pending to be auto-snapped. For example:

<StatusExample />

The output for this _hypothetical_ workspace lists the modified components and the dependent component that will be snapped automatically, when their dependency is snapped:

<AutoSnapStatusOutput />

## Explore previous versions

Use the 'changelog' tab (in the UI) to review previous component versions. Browse thorough the component tabs to see its past states in its documentation, compositions, dependency graph, and more.

<Image alt="changelog" src={changelog} maxWidth={700} hasBackground />

<br />

To review past versions in the terminal, run the following:

<LogExample />

<ExpandedLog />

### Compare versions

Use the 'compare' tab to compare previous versions.

<Image alt="comparing two versions" src={compare} />

Alternatively, run the following to compare versions in the terminal:

<DiffExample />

### Checkout a version

You can checkout a different component version to your workspace, to review and maintain its files and config from that point in time, or more precisely, from that snap in the component's history tree.

To learn more, see [Update components](/getting-started/collaborate/update-components).
